"use strict";(self.webpackChunk_upscalerjs_docs=self.webpackChunk_upscalerjs_docs||[]).push([[6464],{54852:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var r=n(49231);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=r.createContext({}),p=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},c=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,s=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=p(n),m=o,h=d["".concat(l,".").concat(m)]||d[m]||u[m]||s;return n?r.createElement(h,a(a({ref:t},c),{},{components:n})):r.createElement(h,a({ref:t},c))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var s=n.length,a=new Array(s);a[0]=d;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:o,a[1]=i;for(var p=2;p<s;p++)a[p]=n[p];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},30009:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>s,metadata:()=>i,toc:()=>p});var r=n(74011),o=(n(49231),n(54852));const s={category:"Browser",hide_table_of_contents:!0,sidebar_position:3,code_embed:{params:"embed=1&file=index.js&hideExplorer=1",type:"stackblitz",url:"/examples/tensors"}},a="Working with Tensors",i={unversionedId:"documentation/guides/browser/tensors",id:"documentation/guides/browser/tensors",title:"Working with Tensors",description:"View this page on the UpscalerJS website",source:"@site/docs/documentation/guides/browser/tensors.md",sourceDirName:"documentation/guides/browser",slug:"/documentation/guides/browser/tensors",permalink:"/documentation/guides/browser/tensors",draft:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{category:"Browser",hide_table_of_contents:!0,sidebar_position:3,code_embed:{params:"embed=1&file=index.js&hideExplorer=1",type:"stackblitz",url:"/examples/tensors"}},sidebar:"documentationSidebar",previous:{title:"Models",permalink:"/documentation/guides/browser/models"},next:{title:"Patch Sizes",permalink:"/documentation/guides/browser/performance/patch-sizes"}},l={},p=[{value:"Tensors",id:"tensors",level:2},{value:"Tensor as Input",id:"tensor-as-input",level:2},{value:"Tensor as Output",id:"tensor-as-output",level:2},{value:"Managing Memory",id:"managing-memory",level:2}],c={toc:p};function u(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"working-with-tensors"},"Working with Tensors"),(0,o.kt)("a",{class:"docs-link",href:"https://upscalerjs.com/documentation/guides/browser/tensors"},"View this page on the UpscalerJS website"),(0,o.kt)("p",null,"Here we'll discuss working with tensors directly within the context of UpscalerJS."),(0,o.kt)("a",{href:"https://stackblitz.com/github/thekevinscott/upscalerjs/tree/main/examples/tensors?file=index.js&title=UpscalerJS: Working with Tensors"},"Open in Stackblitz"),".",(0,o.kt)("h2",{id:"tensors"},"Tensors"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://thekevinscott.com/tensors-in-javascript/"},"Tensors are a data type used in neural networks"),", and they're used internally to represent the images being upscaled in UpscalerJS."),(0,o.kt)("p",null,"If we're already working with tensors in the context of our application, it can often be more performant to work directly with tensors throughout the process. Doing so can give finer grained control over memory management and performance."),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"If you stick with the defaults, you won't need to know anything about tensors. UpscalerJS will automatically handle everything for you. This guide is for those wishing to exercise more control over memory and performance.")),(0,o.kt)("p",null,"Here we'll discuss the particulars of working with tensors in UpscalerJS."),(0,o.kt)("h2",{id:"tensor-as-input"},"Tensor as Input"),(0,o.kt)("p",null,"Let's say we've got a tensor that we'd like to upscale."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"For the purposes of this example, you'll create a tensor with ",(0,o.kt)("inlineCode",{parentName:"p"},"tf.browser.fromPixels"),". This is the same method used internally by UpscalerJS, so using this method is redundant unless you have additional steps you wish to perform on your tensor.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"import flower from '/path/to/flower.png'\n\nconst tensor = tf.browser.fromPixels(flower)\n// inspect this tensor further with:\n// tensor.print()\n")),(0,o.kt)("p",null,"We can provide the tensor directly to UpscalerJS for processing, and it will automatically process it:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"import Upscaler from 'upscaler'\n\nconst upscaler = new Upscaler()\n\nupscaler.upscale(tensor).then(upscaledSrc => {\n  console.log(upscaledSrc)\n})\n")),(0,o.kt)("h2",{id:"tensor-as-output"},"Tensor as Output"),(0,o.kt)("p",null,"We can also return a tensor in the output of our operation. Doing so will be slightly more performant and give us finer grained control over memory management."),(0,o.kt)("p",null,"We can specify the return type as ",(0,o.kt)("inlineCode",{parentName:"p"},"tensor")," by providing the ",(0,o.kt)("inlineCode",{parentName:"p"},"output")," argument:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"upscaler.upscale(tensor, {\n  output: 'tensor',\n}).then(upscaledTensor => {\n  upscaledTensor.print()\n})\n")),(0,o.kt)("h2",{id:"managing-memory"},"Managing Memory"),(0,o.kt)("p",null,"Whenever providing a tensor or specifying a ",(0,o.kt)("inlineCode",{parentName:"p"},"tensor")," response, we become responsible for disposing of tensor memory ourselves. We can do this by explicitly calling ",(0,o.kt)("inlineCode",{parentName:"p"},"tensor.dispose()")," on the tensors when we're done with them."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"upscaler.upscale(tensor, {\n  output: 'tensor',\n}).then(upscaledTensor => {\n  // we are now done with our initial tensor; dispose of its memory\n  tensor.dispose()\n\n  // do something with the upscaled tensor\n  upscaledTensor.print()\n\n  // dispose of the upscaled tensor\n  upscaledTensor.dispose()\n})\n")),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},(0,o.kt)("a",{parentName:"p",href:"https://js.tensorflow.org/api/latest/#tidy"},"Tensorflow.js provides a handy method, ",(0,o.kt)("inlineCode",{parentName:"a"},"tidy")),", for automatically managing tensor memory within synchronous methods. However, most UpscalerJS methods are asynchronous, so take care not to use ",(0,o.kt)("inlineCode",{parentName:"p"},"tidy")," outside of the context of a synchronous function.")),(0,o.kt)("p",null,"Next, read about some performance optimizations we can take to squeeze the most performance out of UpscalerJS in the browser."))}u.isMDXComponent=!0}}]);