"use strict";(self.webpackChunk_upscalerjs_docs=self.webpackChunk_upscalerjs_docs||[]).push([[2683],{54852:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>c});var i=n(49231);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=i.createContext({}),s=function(e){var t=i.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=s(e.components);return i.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},m=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,p=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),m=s(n),c=a,h=m["".concat(p,".").concat(c)]||m[c]||u[c]||r;return n?i.createElement(h,o(o({ref:t},d),{},{components:n})):i.createElement(h,o({ref:t},d))}));function c(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,o=new Array(r);o[0]=m;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:a,o[1]=l;for(var s=2;s<r;s++)o[s]=n[s];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}m.displayName="MDXCreateElement"},46331:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>s});var i=n(74011),a=(n(49231),n(54852));const r={title:"Troubleshooting",description:"Troubleshooting",sidebar_position:5},o=void 0,l={unversionedId:"documentation/troubleshooting",id:"documentation/troubleshooting",title:"Troubleshooting",description:"Troubleshooting",source:"@site/docs/documentation/troubleshooting.md",sourceDirName:"documentation",slug:"/documentation/troubleshooting",permalink:"/documentation/troubleshooting",draft:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{title:"Troubleshooting",description:"Troubleshooting",sidebar_position:5},sidebar:"documentationSidebar",previous:{title:"getModel",permalink:"/documentation/api/getModel"},next:{title:"Support",permalink:"/documentation/support"}},p={},s=[{value:"Padding is undefined",id:"padding-is-undefined",level:2},{value:"Progress Specified Without Patch Size",id:"progress-specified-without-patch-size",level:2},{value:"Unexpected Token",id:"unexpected-token",level:2},{value:"Missing Model Path",id:"missing-model-path",level:2},{value:"Missing Model Scale",id:"missing-model-scale",level:2},{value:"Invalid Warmup Value",id:"invalid-warmup-value",level:2},{value:"Environment disallows String Input",id:"environment-disallows-string-input",level:2},{value:"Invalid Predicted Tensor",id:"invalid-predicted-tensor",level:2},{value:"Invalid Model Prediction",id:"invalid-model-prediction",level:2},{value:"Environment disallows Base64",id:"environment-disallows-base64",level:2},{value:"Invalid Model Type",id:"invalid-model-type",level:2},{value:"Error with Model Input Shape",id:"error-with-model-input-shape",level:2},{value:"Input Size and Patch Size",id:"input-size-and-patch-size",level:2},{value:"Patch Size Indivisible by Divisibility Factor",id:"patch-size-indivisible-by-divisibility-factor",level:2},{value:"Patch Size Plus Padding Indivisible by Divisibility Factor",id:"patch-size-plus-padding-indivisible-by-divisibility-factor",level:2}],d={toc:s};function u(e){let{components:t,...r}=e;return(0,a.kt)("wrapper",(0,i.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("a",{class:"docs-link",href:"https://upscalerjs.com/documentation/troubleshooting"},"View this page on the UpscalerJS website"),(0,a.kt)("h1",{id:"troubleshooting"},"Troubleshooting"),(0,a.kt)("h2",{id:"padding-is-undefined"},"Padding is undefined"),(0,a.kt)("p",null,"If specifying a patch size but not padding, you will likely encounter artifacting in the upscaled image."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Image with artifacting",src:n(57718).Z,width:"396",height:"396"})),(0,a.kt)("p",null,"Most of the time, this artifacting is undesired. To resolve the artifacting, add an explicit padding:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"upscaler.upscale('/path/to/img', {\n  patchSize: 64,\n  padding: 4,\n})\n")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Image with artifacting",src:n(19167).Z,width:"394",height:"396"})),(0,a.kt)("p",null,"If you would like to keep artifacting but hide the warning message, pass an explicit padding value of 0:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"upscaler.upscale('/path/to/img', {\n  patchSize: 64,\n  padding: 0,\n})\n")),(0,a.kt)("h2",{id:"progress-specified-without-patch-size"},"Progress Specified Without Patch Size"),(0,a.kt)("p",null,"If you've specified a ",(0,a.kt)("inlineCode",{parentName:"p"},"progress")," callback but are not specifying ",(0,a.kt)("inlineCode",{parentName:"p"},"patchSize")," in the call to ",(0,a.kt)("inlineCode",{parentName:"p"},"upscale"),", the ",(0,a.kt)("inlineCode",{parentName:"p"},"progress")," callback will never be called. ",(0,a.kt)("inlineCode",{parentName:"p"},"progress")," callbacks only occur when ",(0,a.kt)("inlineCode",{parentName:"p"},"patchSize")," is provided."),(0,a.kt)("p",null,"In order to have your ",(0,a.kt)("inlineCode",{parentName:"p"},"progress")," callback be called, provide explicit patch sizes:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"upscaler.upscale('/path/to/img', {\n  patchSize: 64,\n  progress: ...\n})\n")),(0,a.kt)("h2",{id:"unexpected-token"},"Unexpected Token"),(0,a.kt)("p",null,"If you're in a Node.js environment, you may encounter something like this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"/node_modules/upscaler/dist/browser/esm/index.js:1\nexport { default, } from './upscaler';\n^^^^^^\n\nSyntaxError: Unexpected token 'export'\n")),(0,a.kt)("p",null,"This likely means one of two things:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"You are using ",(0,a.kt)("inlineCode",{parentName:"li"},"upscaler"),", instead of ",(0,a.kt)("inlineCode",{parentName:"li"},"upscaler/node"),"; ",(0,a.kt)("a",{parentName:"li",href:"/documentation/guides/node/nodejs"},"check out the guide on Node.js here"),"."),(0,a.kt)("li",{parentName:"ul"},"You are using ",(0,a.kt)("inlineCode",{parentName:"li"},"import")," syntax instead of ",(0,a.kt)("inlineCode",{parentName:"li"},"require")," syntax; if so, try switching to ",(0,a.kt)("inlineCode",{parentName:"li"},"require('upscaler')"),". For more information on this, ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/thekevinscott/UpscalerJS/issues/554#issuecomment-1344108954"},"see this Github issue"),".")),(0,a.kt)("h2",{id:"missing-model-path"},"Missing Model Path"),(0,a.kt)("p",null,"If you see an error like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'Error: You must provide a "path" when providing a model definition\n')),(0,a.kt)("p",null,"You've passed a ",(0,a.kt)("inlineCode",{parentName:"p"},"null")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"undefined")," path argument in the ",(0,a.kt)("inlineCode",{parentName:"p"},"model")," argument to UpscalerJS:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"const upscaler = new Upscaler({\n  model: {\n    path: null,\n  },\n})\n")),(0,a.kt)("p",null,"Ensure you pass a valid ",(0,a.kt)("inlineCode",{parentName:"p"},"path")," argument in the ",(0,a.kt)("inlineCode",{parentName:"p"},"model")," payload. ",(0,a.kt)("a",{parentName:"p",href:"/documentation/guides/browser/models"},"See the guide on models for more information"),"."),(0,a.kt)("h2",{id:"missing-model-scale"},"Missing Model Scale"),(0,a.kt)("p",null,"If you see an error like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'Error: You must provide a "scale" when providing a model definition\n')),(0,a.kt)("p",null,"You've passed a ",(0,a.kt)("inlineCode",{parentName:"p"},"null")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"undefined")," scale argument in the ",(0,a.kt)("inlineCode",{parentName:"p"},"model")," argument to UpscalerJS:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"const upscaler = new Upscaler({\n  model: {\n    scale: null,\n  },\n})\n")),(0,a.kt)("p",null,"Every model must have an explicit ",(0,a.kt)("inlineCode",{parentName:"p"},"scale")," defined."),(0,a.kt)("p",null,"Ensure you pass a valid ",(0,a.kt)("inlineCode",{parentName:"p"},"scale")," argument in the ",(0,a.kt)("inlineCode",{parentName:"p"},"model")," payload. ",(0,a.kt)("a",{parentName:"p",href:"/documentation/guides/browser/models"},"See the guide on models for more information"),"."),(0,a.kt)("h2",{id:"invalid-warmup-value"},"Invalid Warmup Value"),(0,a.kt)("p",null,"If you see an error like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Error: Invalid value passed to warmup in warmupSizes: foo\n")),(0,a.kt)("p",null,"It means you've called ",(0,a.kt)("inlineCode",{parentName:"p"},".warmup")," with an invalid value:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"upscaler.warmup('foo')\n")),(0,a.kt)("p",null,"Ensure you're passing one of the following:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"{ patchSize: number; padding: number }")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"[width, height]")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"{ patchSize: number; padding: number }[]")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"[width, height][]"))),(0,a.kt)("p",null,"For more information, ",(0,a.kt)("a",{parentName:"p",href:"/documentation/guides/browser/performance/warmup"},"see the guide on warm ups"),", or review the ",(0,a.kt)("a",{parentName:"p",href:"/documentation/api/warmup"},"API documentation on the ",(0,a.kt)("inlineCode",{parentName:"a"},"warmup")," method"),"."),(0,a.kt)("h2",{id:"environment-disallows-string-input"},"Environment disallows String Input"),(0,a.kt)("p",null,"If you see an error like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Error: Environment does not support a string URL as an input format.\n")),(0,a.kt)("p",null,"This means that the environment UpscalerJS is running in does not have access to ",(0,a.kt)("inlineCode",{parentName:"p"},"Image"),". This means that it cannot construct an image and load its src."),(0,a.kt)("p",null,"Examples of such environments include web workers and the like (e.g., Cloudflare workers)."),(0,a.kt)("p",null,"To get around this error, pass your data into UpscalerJS as a tensor. For an example, ",(0,a.kt)("a",{parentName:"p",href:"/documentation/guides/browser/performance/webworker"},"check out the guide on web workers"),"."),(0,a.kt)("h2",{id:"invalid-predicted-tensor"},"Invalid Predicted Tensor"),(0,a.kt)("p",null,"UpscalerJS only supports models that return rank 4 tensors representing image-like data."),(0,a.kt)("p",null,"You may see this message if you're using a custom model that returns a rank 3 image, or non-image-like data (like text)."),(0,a.kt)("p",null,"If you believe this is in error, or you have a particular use case you think would be appropriate for UpscalerJS, ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/thekevinscott/UpscalerJS/issues/new/choose"},"please open a Github issue"),"."),(0,a.kt)("h2",{id:"invalid-model-prediction"},"Invalid Model Prediction"),(0,a.kt)("p",null,"UpscalerJS only supports models that return rank 4 tensors representing image-like data."),(0,a.kt)("p",null,"You may see this message if you're using a custom model that returns a non-tensor."),(0,a.kt)("p",null,"If you believe this is in error, or you have a particular use case you think would be appropriate for UpscalerJS, ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/thekevinscott/UpscalerJS/issues/new/choose"},"please open a Github issue"),"."),(0,a.kt)("h2",{id:"environment-disallows-base64"},"Environment disallows Base64"),(0,a.kt)("p",null,"If you see an error like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Error: Environment does not support base64 as an output format.\n")),(0,a.kt)("p",null,"This means that the environment UpscalerJS is running in does not have access to ",(0,a.kt)("inlineCode",{parentName:"p"},"Image")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"document"),". This means that it cannot automatically transform a tensor into a base64 representation."),(0,a.kt)("p",null,"Examples of such environments include web workers and the like (e.g., Cloudflare workers)."),(0,a.kt)("p",null,"To get around this error, specify ",(0,a.kt)("inlineCode",{parentName:"p"},"tensor")," as the ",(0,a.kt)("inlineCode",{parentName:"p"},"output")," format of your data, like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"upscaler.upscale(tensor, {\n  output: 'tensor',\n})\n")),(0,a.kt)("p",null,(0,a.kt)("em",{parentName:"p"},"Note: If you've neglected to provide an ",(0,a.kt)("inlineCode",{parentName:"em"},"output")," argument and you're running the browser version of UpscalerJS, you will need to explicitly provide the ",(0,a.kt)("inlineCode",{parentName:"em"},"output")," argument. This is because the default argument is ",(0,a.kt)("inlineCode",{parentName:"em"},"base64"),".")),(0,a.kt)("p",null,"For an example, ",(0,a.kt)("a",{parentName:"p",href:"/documentation/guides/browser/performance/webworker"},"check out the guide on web workers"),"."),(0,a.kt)("h2",{id:"invalid-model-type"},"Invalid Model Type"),(0,a.kt)("p",null,"Acceptable model types include:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"layers")," (default)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"graph"))),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://js.tensorflow.org/api/latest/#Models-Loading"},"These correspond to the model types supported by Tensorflow.js"),"."),(0,a.kt)("p",null,"If you don't know what kind of model you have, you may be able to inspect your ",(0,a.kt)("inlineCode",{parentName:"p"},"model.json"),". If the JSON file has an entry like below, it's a ",(0,a.kt)("inlineCode",{parentName:"p"},"layers")," model:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{"format": "layers-model", \n')),(0,a.kt)("p",null,"If it has an entry like below, it's a ",(0,a.kt)("inlineCode",{parentName:"p"},"graph")," model:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{"format": "graph-model", \n')),(0,a.kt)("h2",{id:"error-with-model-input-shape"},"Error with Model Input Shape"),(0,a.kt)("p",null,"This error implies that the given model does not have an input layer compatible with a rank 4 tensor. It may be expected a rank 3 tensor, or something else entirely."),(0,a.kt)("p",null,"UpscalerJS only supports models whose input layers are set up to accept rank 4 tensors."),(0,a.kt)("p",null,"If you believe this is in error, or you have a particular use case you think would be appropriate for UpscalerJS, ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/thekevinscott/UpscalerJS/issues/new/choose"},"please open a Github issue"),"."),(0,a.kt)("h2",{id:"input-size-and-patch-size"},"Input Size and Patch Size"),(0,a.kt)("p",null,"Some models have fixed input shapes that require images be of a certain shape."),(0,a.kt)("p",null,"For these models, ",(0,a.kt)("inlineCode",{parentName:"p"},"patchSize")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"padding")," variables will be ignored."),(0,a.kt)("p",null,"Please omit these variables for these models."),(0,a.kt)("h2",{id:"patch-size-indivisible-by-divisibility-factor"},"Patch Size Indivisible by Divisibility Factor"),(0,a.kt)("p",null,"Some models define a ",(0,a.kt)("inlineCode",{parentName:"p"},"divisibilityFactor"),", or a number for which all images must be a multiple."),(0,a.kt)("p",null,"For example, a ",(0,a.kt)("inlineCode",{parentName:"p"},"divisibilityFactor")," of ",(0,a.kt)("inlineCode",{parentName:"p"},"64")," and an image size of ",(0,a.kt)("inlineCode",{parentName:"p"},"65,65")," would have to operate on a padded image of ",(0,a.kt)("inlineCode",{parentName:"p"},"128,128"),". (The final image would be ",(0,a.kt)("inlineCode",{parentName:"p"},"65,65"),", as UpscalerJS handles the padding and trimming of the image behind the scenes for you.)"),(0,a.kt)("p",null,"This warning means that you are passing in a ",(0,a.kt)("inlineCode",{parentName:"p"},"patchSize")," argument incompatible with the model's ",(0,a.kt)("inlineCode",{parentName:"p"},"divisibilityFactor"),". For instance, with a ",(0,a.kt)("inlineCode",{parentName:"p"},"divisibilityFactor")," of ",(0,a.kt)("inlineCode",{parentName:"p"},"64"),", invalid ",(0,a.kt)("inlineCode",{parentName:"p"},"patchSize")," arguments would include ",(0,a.kt)("inlineCode",{parentName:"p"},"32"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"65"),", or ",(0,a.kt)("inlineCode",{parentName:"p"},"127"),". Valid ",(0,a.kt)("inlineCode",{parentName:"p"},"patchSize")," arguments would include ",(0,a.kt)("inlineCode",{parentName:"p"},"64")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"128"),"."),(0,a.kt)("p",null,"To get rid of this warning, update your ",(0,a.kt)("inlineCode",{parentName:"p"},"patchSize")," argument to be a multiple of the ",(0,a.kt)("inlineCode",{parentName:"p"},"divisibilityFactor"),"."),(0,a.kt)("h2",{id:"patch-size-plus-padding-indivisible-by-divisibility-factor"},"Patch Size Plus Padding Indivisible by Divisibility Factor"),(0,a.kt)("p",null,"This error is identical to the above, except that the final ",(0,a.kt)("inlineCode",{parentName:"p"},"patchSize")," is equivalent to ",(0,a.kt)("inlineCode",{parentName:"p"},"patchSize")," + ",(0,a.kt)("inlineCode",{parentName:"p"},"padding")," * 2, and this final number must be equal to or a multiple of the model's ",(0,a.kt)("inlineCode",{parentName:"p"},"divisibilityFactor"),"."),(0,a.kt)("p",null,"For example, for a model with a ",(0,a.kt)("inlineCode",{parentName:"p"},"divisibilityFactor")," of ",(0,a.kt)("inlineCode",{parentName:"p"},"64")," and a ",(0,a.kt)("inlineCode",{parentName:"p"},"patchSize")," of ",(0,a.kt)("inlineCode",{parentName:"p"},"126"),", a valid ",(0,a.kt)("inlineCode",{parentName:"p"},"padding")," value would be ",(0,a.kt)("inlineCode",{parentName:"p"},"1"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"126 + (1 * 2) = 128 // 128 is divisible by 64\n")),(0,a.kt)("p",null,"To get rid of this warning, update your ",(0,a.kt)("inlineCode",{parentName:"p"},"patchSize")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"padding")," arguments to result in a multiple of the ",(0,a.kt)("inlineCode",{parentName:"p"},"divisibilityFactor"),"."))}u.isMDXComponent=!0},57718:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/image-with-artifacting-adf159d8cbb95b661639245fd9ec6faf.png"},19167:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/image-without-artifacting-2c1cd97cb589f3212310b7d74259f1d6.png"}}]);