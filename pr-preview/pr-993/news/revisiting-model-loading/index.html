<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Revisiting Model Loading | UpscalerJS</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://upscalerjs.com/news/revisiting-model-loading"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Revisiting Model Loading | UpscalerJS"><meta data-rh="true" name="description" content="I posted a discussion to Github about work towards refactoring the way we load models in UpscalerJS. I&#x27;ll repost it here for posterity."><meta data-rh="true" property="og:description" content="I posted a discussion to Github about work towards refactoring the way we load models in UpscalerJS. I&#x27;ll repost it here for posterity."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-02-03T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/thekevinscott"><meta data-rh="true" property="article:tag" content="roadmap"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://upscalerjs.com/news/revisiting-model-loading"><link data-rh="true" rel="alternate" href="https://upscalerjs.com/news/revisiting-model-loading" hreflang="en"><link data-rh="true" rel="alternate" href="https://upscalerjs.com/news/revisiting-model-loading" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://ORVKVNO89C-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/news/rss.xml" title="UpscalerJS RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/news/atom.xml" title="UpscalerJS Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="UpscalerJS" href="/opensearch.xml">


<script src="https://plausible.io/js/script.js" defer="defer" data-domain="upscalerjs.com"></script><link rel="stylesheet" href="/assets/css/styles.6a2a9ea3.css">
<link rel="preload" href="/assets/js/runtime~main.16ffb555.js" as="script">
<link rel="preload" href="/assets/js/main.7f4b7a4a.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_Wr3w" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">UpscalerJS</b></a><a class="navbar__item navbar__link" href="/demo">Demo</a><a class="navbar__item navbar__link" href="/documentation">Docs</a><a class="navbar__item navbar__link" href="/models">Models</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/news">News</a></div><div class="navbar__items navbar__items--right"><a href="https://npmjs.com/package/upscaler" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link" aria-label="UpscalerJS NPM package">npm<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Bo_Q"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/thekevinscott/UpscalerJS" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link" aria-label="UpscalerJS GitHub repository">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Bo_Q"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_cah6 colorModeToggle_R1hC"><button class="clean-btn toggleButton_IeX2 toggleButtonDisabled_nkqn" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_V9aW"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_AEwI"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_w7pD"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_MWiQ"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_J2G8 thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_qgbU margin-bottom--md">Recent posts</div><ul class="sidebarItemList_gXg0 clean-list"><li class="sidebarItem_k2Pw"><a class="sidebarItemLink_EacS" href="/news/welcome-upscalerjs">New Documentation Site</a></li><li class="sidebarItem_k2Pw"><a aria-current="page" class="sidebarItemLink_EacS sidebarItemLinkActive_p3UE" href="/news/revisiting-model-loading">Revisiting Model Loading</a></li><li class="sidebarItem_k2Pw"><a class="sidebarItemLink_EacS" href="/news/1.0-roadmap">1.0 Roadmap</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_yOVD" itemprop="headline">Revisiting Model Loading</h1><div class="container_ATfQ margin-vert--md"><time datetime="2022-02-03T00:00:00.000Z" itemprop="datePublished">February 3, 2022</time> Â· <!-- -->6 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Oe3t"><div class="avatar margin-bottom--sm"><a href="https://github.com/thekevinscott" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/thekevinscott.png" alt="Kevin Scott"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/thekevinscott" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Kevin Scott</span></a></div><small class="avatar__subtitle" itemprop="description">UpscalerJS Czar</small></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p><a href="https://github.com/thekevinscott/UpscalerJS/discussions/30" target="_blank" rel="noopener noreferrer">I posted a discussion to Github about work towards refactoring the way we load models in UpscalerJS</a>. I&#x27;ll repost it here for posterity.</p><p>For the 1.0 release, I&#x27;d like to discuss, and potentially revisit, how models are configured in UpscalerJS.</p><hr><p>There&#x27;s three ways a user interacts with a model in UpscalerJS:</p><ul><li>No explicit model selection. (<code>new Upscaler()</code> - By default, UpscalerJS will use the <code>idealo/gans</code>, which afaik is not documented anywhere.)</li><li>Explicit model selection (<code>new Upscaler({ model: &#x27;div2k-2x&#x27;, scale: 2 })</code>)</li><li>Custom model (<code>new Upscaler({ model: &#x27;/path/to/custom/model&#x27;, scale: 2 })</code>)</li></ul><p>I&#x27;d wager the majority of people go with option 1. So it makes sense to choose a sensible default that offers a good tradeoff between performance and accuracy.</p><p>That said, there are many valid reasons to encourage people to explore option 2, and make it easy for them to do so. Today those include:</p><ul><li><strong>Wanting a different scale model</strong></li></ul><p>In the near future, those include:</p><ul><li><strong>Wanting either a <em>more accurate</em> model than the default, or a <em>faster</em> model than the default</strong>. This is a little theoretical today as we only offer two flavors of models, which is a separate discussion - <a href="https://github.com/thekevinscott/UpscalerJS/discussions/32" target="_blank" rel="noopener noreferrer">how to train and include more models easily</a> - but UpscalerJS is set up to support different model architectures, so there&#x27;s no reason we couldn&#x27;t have a simpler model that runs faster, or a heavier more accurate implementation.</li><li><strong>A domain-specific model</strong>. There&#x27;s compelling research indicating that domain-specific models can outperform more general ones (e.g., that a model trained specifically on faces, or one trained on illustrations, can out-perform the more general use case). Being able to experiment with a &quot;face&quot; model, or an &quot;illustration&quot; model, could be very nice. </li><li><strong>Different channeled models</strong>. There&#x27;s <a href="https://github.com/thekevinscott/UpscalerJS/issues/8" target="_blank" rel="noopener noreferrer">been an ask for models</a> that operate in different <em>channels</em> - aka, supporting transparency. I also think a grayscale version would be interesting to explore as it&#x27;d likely be a much faster model operating on a single channel.</li></ul><p>Today, if a user wants to see what models are available, they can either call <code>getModelDefinitions</code> from within the package, or they&#x27;re directed to this second repo - <a href="https://github.com/thekevinscott/UpscalerJS-models" target="_blank" rel="noopener noreferrer">https://github.com/thekevinscott/UpscalerJS-models</a>. The reason models live in a separate repo is because of size. Models must be served over the web (aka, not packaged) so we serve them via a CDN. Including these in the core npm library would bloat its download size significantly, which would be particularly frustrating given most users would only need a single model.</p><p>That said, that particular repo is missing the default model used (idealo/gans) and doesn&#x27;t provide a good way of experimenting with models to see how they perform with real world data. It&#x27;s also hard to keep the two repos up to date (because the core UpscalerJS library must maintain references to the upscalerjs-models repo).</p><hr><p>A word on models and their configuration.</p><p>To me, a model encompasses the following:</p><ul><li>A particular architecture, or algorithm - for instance, <a href="https://arxiv.org/abs/1809.00219" target="_blank" rel="noopener noreferrer">ESRGAN</a></li><li>A particular implementation of that architecture - for instance, <a href="https://github.com/idealo/image-super-resolution" target="_blank" rel="noopener noreferrer">idealo&#x27;s implementation of ESRGAN</a></li><li>The dataset used to train that model - for instance, <a href="https://data.vision.ee.ethz.ch/cvl/DIV2K/" target="_blank" rel="noopener noreferrer">DIV2K</a></li><li>The scale the model is trained at - 2, 3, 4</li><li><em>Train-time</em> related configuration that can affect inference configuration - for instance, number of supported channels, which would need to be chosen correctly in order to support specific images</li><li><em>Train-time</em> related configuration that can affect performance - for instance, pruning strategy, along with more architecture-specific training settings such as G and G0 (<a href="https://github.com/idealo/image-super-resolution#training" target="_blank" rel="noopener noreferrer">as illustrated here</a>)</li><li><em>Compile-time</em> related configuration, such as quantization amount, which could affect performance</li></ul><p>The end result of all of this configuration is a single model file.</p><hr><p>Let&#x27;s talk questions:</p><ul><li>If you&#x27;re <em>not</em> using the default model today, how did you find, explore, and choose the model you&#x27;re using?</li><li>What&#x27;s the right place to find and explore available models? In the README? In the documentation page? On a dedicated models page, or dedicated repo? All three?</li><li>What&#x27;s an ergonomic way of choosing a model? Should models have simple-to-understand names (aka, <code>face-2x-grayscale</code>), or should they be more verbose, reflecting their underlying configuration (e.g., <code>esrgan-idealo-div2k-2-1-channel</code>, or <code>esrgan/idealo/div2k/2/1-channel</code>)? If the former, where and how would a user learn more information about the particular model (how it was trained, how to reproduce the results)? If the latter, how do we form that string to effectively communicate the model&#x27;s configuration?</li><li>Similar to the above - is it better to specify a single path to a model, or is it better to pass an object denoting that model, something like <code>{ dataset: &#x27;DIV2K&#x27;, scale: 2, channels: 4 }</code>? If the latter, how do we handle cases where we don&#x27;t have a model for a particular configuration?</li><li>Is a <em>runtime</em> method useful for returning information about the model? Or will users only be interacting with these things when developing their software (aka, we can communicate a model&#x27;s configuration offline)?</li></ul><p>My top-level thoughts:</p><ul><li>Making it easy to keep models up-to-date and in-sync is good. I wonder if we could bring the models back into this repo, and use something like <code>lerna</code> to publish two npm packages from this single repo.</li><li>Redundancy of documentation is probably good (aka, showing information about the models in multiple places is fine, as people get their documentation from all kinds of places).</li><li>Live interaction in real time is best; there should be a tool that allows for experimentation with different models in real time, that also generates instantiation code for you.</li></ul><p>Curious to hear from others on your thoughts!</p><hr><p>UPDATE (2/3/22)</p><p>Some updates since I wrote this post:</p><blockquote><p>Making it easy to keep models up-to-date and in-sync is good. I wonder if we could bring the models back into this repo, and use something like lerna to publish two npm packages from this single repo.</p></blockquote><p>This is now done. Models live in the repo and are published as a separate package on NPM.</p><p><a href="https://github.com/thekevinscott/UpscalerJS/discussions/163" target="_blank" rel="noopener noreferrer">I also set out a roadmap</a> that includes Node support as a precursor, so that&#x27;s another thing worth considering in this discussion.</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_q9gC"><div class="col"><b>Tags:</b><ul class="tags_YNKq padding--none margin-left--sm"><li class="tag_ObgS"><a class="tag_EetH tagRegular_sxQr" href="/news/tags/roadmap">roadmap</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/news/welcome-upscalerjs"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">New Documentation Site</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/news/1.0-roadmap"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">1.0 Roadmap</div></a></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Play</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/demo">Demo</a></li><li class="footer__item"><a class="footer__link-item" href="/documentation/guides/">Examples</a></li></ul></div><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/documentation">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/documentation/getting-started">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/documentation/getting-started#usage">Usage</a></li><li class="footer__item"><a class="footer__link-item" href="/documentation/api/constructor">API</a></li><li class="footer__item"><a class="footer__link-item" href="/documentation/troubleshooting">Troubleshooting</a></li><li class="footer__item"><a class="footer__link-item" href="/documentation/support">Support</a></li></ul></div><div class="col footer__col"><div class="footer__title">Models</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/models/available/esrgan-slim">esrgan-slim</a></li><li class="footer__item"><a class="footer__link-item" href="/models/available/esrgan-medium">esrgan-medium</a></li><li class="footer__item"><a class="footer__link-item" href="/models/available/esrgan-thick">esrgan-thick</a></li><li class="footer__item"><a class="footer__link-item" href="/models/available/esrgan-legacy">esrgan-legacy</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 Kevin Scott (<a target="_blank" href="https://thekevinscott.com">@thekevinscott</a>) | <a target="_blank" href="https://github.com/thekevinscott/UpscalerJS/blob/master/LICENSE">This project is licensed under the MIT License</a>.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.16ffb555.js"></script>
<script src="/assets/js/main.7f4b7a4a.js"></script>
</body>
</html>